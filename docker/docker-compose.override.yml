version: '2'
services:
  broker:
    container_name: compose_broker
    command: broker -c env.ini
    ports:
      - 9000:9000
      - 9001:9001
    volumes:
      - ../:/usr/src/app
    links:
      - postgres
    environment:
     - BROKER_DATABASE_HOSTNAME=postgres
     - BROKER_DATABASE_PASSWORD=dq_broker

  tests:
    command: python setup.py test
    volumes:
      - ../:/usr/src/app
    links:
      - postgres

  tests-pipeline:
    extends:
      file: docker-compose.yml
      service: tests
    command: python setup.py full_test
    links:
      - postgres
